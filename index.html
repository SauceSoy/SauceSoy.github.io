<!DOCTYPE html>
<html>
<head>
<style>
.button {
    background-image: url("https://imgur.com/EcZji");
    padding: 10px;
    text-align: center;
    color: #FF0000;
    border-radius: 10px;
    width: 100px;
    height: 100%;
}
h3 {
  display: inline-block;
  margin: 0;
}
</style>
</head>
<body>
<div id="fish">Fish: 0</div>
</body>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script>
const frameRate = 100;

var rawData = [
	{
        "Name": "Hire Fisherman",
		"Cost": 10,
        "Description": "These guys catch fish for you. Their cost? ",
		"Button": null,
		"CostMulti": 1.1,
		"Value": 1,
        "OnClick": function() {
            rawData[0].Value++;
            fish-= rawData[0].Cost;
            rawData[0].Cost *= rawData[0].CostMulti;
            if (!hasEnoughFish()) {
                setDisabled(rawData[0].Button);
            }
        },
        "Label": null
	},
    {
        "Name": "Hire Fisherman Instructor",
        "Cost": 0,
        "Description": "Need more fisherman? Its your lucky day. Fisherman instructors teach young fisherman how to fish. You will need to sacrifice some adult fisherman first: ",
        "Button": null,
        "CostMulti": 0,
        "Value": 0,
        "N1Cost": 10,
        "N1Bonus": 2,
        "OnClick": function() {
            N1Click(1);
        }
    },
    {
        "Name": "Hire Wise Fisherman",
        "Description": "The wiser the better. Sacrificial amount: ",
        "Button": null,
        "Value": 0,
        "N1Cost": 100,
        "N1Bonus": 2,
        "OnClick": function() {
            N1Click(2);
        }
    },
    {
        "Name": "Hire Fisherboat",
        "Description": "Creating this boat requires many wise fisherman to help build it. Cost: ",
        "Button": null,
        "Value": 0,
        "N1Cost": 1000,
        "N1Bonus": 2,
        "OnClick": function() {
            N1Click(3);
        }
    }
]

for (let i = 0; i <rawData.length; i++) {
    rawData[i].Button = document.createElement("button");
    rawData[i].Label = document.createElement("h3");
    const t = document.createTextNode(rawData[i].Name);
    const b = document.createElement("br");

    rawData[i].Button.appendChild(t);
    setDisabled(rawData[i].Button);

    document.body.appendChild(rawData[i].Button);
    document.body.appendChild(rawData[i].Label);
    document.body.appendChild(b);

    rawData[i].Button.setAttribute("class", "button");
    rawData[i].Button.setAttribute("title", rawData[i].Description + (rawData[i].N1Cost === undefined ? rawData[i].Cost : rawData[i].N1Cost));
    rawData[i].Button.addEventListener("click", rawData[i].OnClick);
}

class html {
    constructor() {
        this.fish = document.getElementById("fish");
    }
}

let fish = 0;
let documents = new html();

const impButton = document.createElement("button");
const impText = document.createTextNode("Import");

const expButton = document.createElement("button");
const expText = document.createTextNode("Export");

const txtBox = document.createElement("textarea");

impButton.appendChild(impText);
expButton.appendChild(expText);

impButton.setAttribute("class", "button");
expButton.setAttribute("class", "button");

impButton.addEventListener("click", importSave);
expButton.addEventListener("click", exportSave);

document.body.appendChild(impButton);
document.body.appendChild(expButton);
document.body.appendChild(txtBox);

function addBonuses(){
    fish+= frameRate / 1000 * (rawData[0].Value + 1);

    documents.fish.innerHTML = "Fish: " + fish.toPrecision(4);

    for(let i = 1; i < rawData.length; i++) {
        rawData[i-1].Value += rawData[i].N1Bonus * rawData[i].Value * (frameRate/1000);
    }
}

function hasEnoughFish() {
    if (fish > rawData[0].Cost) {
        return true;
    }
    return false;
}

function N1Click(n) {
    rawData[n-1].Value -= rawData[n].N1Cost;
    rawData[n].Value++;
    if (rawData[n-1].Value < rawData[n].N1Cost) {
        setDisabled(rawData[n].Button);
        return;
    }
}

function setDisabled(dom) {
    dom.setAttribute("disabled", "true");
    dom.style.opacity = 0.6;
}
function setEnabled(dom) {
    dom.removeAttribute("disabled");
    dom.style.opacity = 1;
}
setInterval(function() {
    addBonuses();

    if (hasEnoughFish()) {
        setEnabled(rawData[0].Button);
    }

    rawData[0].Label.innerHTML = "You have " + Math.round(rawData[0].Value) + " " + rawData[0].Name.substr(5) + " and they make " + rawData[0].Value.toPrecision(4) + " fish per second";
    for(let i = 1; i < rawData.length; i++) {
        const lblName = rawData[i].Name.substr(5);
        const n1lblName = rawData[i-1].Name.substr(5);
        const perSecAmo = (rawData[i].Value * rawData[i].N1Bonus).toPrecision(4);
        rawData[i].Label.innerHTML = "You have " + Math.round(rawData[i].Value) + " " + lblName + (rawData[i].Value !== 1 ? "s" : "")+ ". In total they make " + perSecAmo + " " + n1lblName + (perSecAmo !== 1 ? "s" : "") + " per second";
    }

    for(let n = 1; n < rawData.length; n++) {
        if (rawData[n-1].Value >= rawData[n].N1Cost) {
            setEnabled(rawData[n].Button);
        }
    }
}, frameRate)

function importSave() {
    try {
    const dec = atob(txtBox.value);
    const json = JSON.parse(dec);

    for (let i = 0; i < json.length-1; i++) {
        rawData[i].Value = json[i].Value;
    }
    fish = json[json.length-1];
    }
    catch(err) {
        console.log(err);
    }
}
function exportSave() {
    let save = [];
    for(let i = 0; i < rawData.length; i++) {
        if (save[i] === undefined) {
            save[i] = {};
        }
        save[i].Value = rawData[i].Value;
    }
    save.push(fish);

    let stringified = JSON.stringify(save);
    const enc = btoa(stringified);

    txtBox.value = enc;
}

</script>
</html> 
